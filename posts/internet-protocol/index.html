<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="本文是IPv4协议的摘要和笔记，IPv4协议格式由RFC791规定。">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>IP协议（RFC791） | Hack Note</title>
<link href="https://cdn.staticfile.org/twitter-bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/css/code.css" rel="stylesheet" type="text/css">
<link href="/assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="/assets/css/highlight.css" rel="stylesheet" type="text/css">
<link href="/assets/css/cerulean.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="/rss.xml">
<link rel="canonical" href="https://blog.wangzhl.com/posts/internet-protocol/">
<link rel="icon" href="/favicon.ico" sizes="64x64">
<!--[if lt IE 9]><script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><script async src="https://www.google-analytics.com/analytics.js"></script><meta name="author" content="Samson Wang">
<link rel="prev" href="/posts/network-protocol-suite/" title="网络通信协议" type="text/html">
<link rel="next" href="/posts/algorithm-weekly-remove-nth-node-from-end-of-list/" title="每周算法：删去单向链表倒数第n个节点" type="text/html">
</head>
<body class="preload">
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->
<nav id="top-nav" class="navbar navbar-expand-md fixed-top mb-4 navbar-dark bg-dark"><div class="container">   <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="/">

      <span id="blog-title">Hack Note</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav ml-auto">
<li class="nav-item">
<a href="/archive/" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="/tags/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="/rss.xml" class="nav-link">RSS Feed</a>

        
      </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
  </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
  <div class="body-content">
    <!--Body content-->
    <div class="row">

      <div class="col-lg-9 col-md-9 col-sm-12 col-xs-12">
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name">IP协议（RFC791）</h1>

    <div class="metadata">
      

      
  <div class="date blur-1">
    <time class="published dt-published" datetime="2018-09-24T20:16:15+08:00" itemprop="datePublished" title="2018-09-24 20:16">Sep 24 2018</time>
</div>

      

      
    <div class="source blur-1">
      <a href="/posts/internet-protocol/index.org" class="sourcelink">Source</a>
    </div>

      
     <div class="link blur-1">
       <a href="https://tools.ietf.org/html/rfc791">Original site</a>
     </div>

      
    <div class="tags blur-2">
    <ul itemprop="keywords">
<li><a class="tag p-category" href="/tags/ip/" rel="tag">ip</a></li>
        <li><a class="tag p-category" href="/tags/network/" rel="tag">network</a></li>
        <li><a class="tag p-category" href="/tags/protocol/" rel="tag">protocol</a></li>
    </ul>
</div>

      

    </div>
  </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>
本文是IPv4协议的摘要和笔记，IPv4协议格式由RFC791规定，RFC791协议的原文可以在 <a href="https://tools.ietf.org/html/rfc791">这里</a> 找到。<br></p>

<!-- TEASER_END -->

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">协议规格</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">协议头格式</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<img src="/assets/images/spinner.svg" data-src="/images/post-internet-protocol-1.png" alt="header format"><br>
其中，每一个小格代表1bit.<br></p>

<p>
<b>Version:</b> 4 bits<br>
The Version field indicates the format of the internet header. This document describes version 4.<br></p>

<p>
<b>IHL:</b> 4 bits<br>
Internet Header Length is the length of the internet header in 32 bit words, and thus points to the beginning of the data. Note that the minimum value for a correct header is 5.<br></p>

<p>
<b>Type of Service:</b> 8 bits<br>
The Type of Service provides an indication of the abstract parameters of the quality of service desired. These parameters are to be used to guide the selection of the actual service parameters when transmitting a datagram through a particular network. Several networks offer service precedence, which somehow treats high precedence traffic as more important than other traffic (generally by accepting only traffic above a certain precedence at time of high load). The major choice is a three way tradeoff between low-delay, high-reliability, and high-throughput.<br>
Bits 0-2: Precedence.<br>
Bit 3: 0 = Normal Delay, 1 = Low Delay.<br>
Bits 4: 0 = Normal Throughput, 1 = High Throughput.<br>
Bits 5: 0 = Normal Relibility, 1 = High Relibility.<br>
Bit 6-7: Reserved for Future Use.<br>
Precedence:<br>
111 - Network Control<br>
110 - Internetwork Control<br>
101 - CRITIC/ECP<br>
100 - Flash Override<br>
011 - Flash<br>
010 - Immediate<br>
001 - Priority<br>
000 - Routine<br>
The use of the Delay, Throughput, and Reliability indications may increase the cost (in some sense) of the service. In many networks better performance for one of these parameters is coupled with worse performance on another. Except for very unusual cases at most two of these three indications should be set.The type of service is used to specify the treatment of the datagram during its transmission through the internet system.<br></p>

<p>
<b>Total Length:</b> 16 bits<br>
Total Length is the length of the datagram, measured in octets,  including internet header and data. This field allows the length of a datagram to be up to 65,535 octets. Such long datagrams are impractical for most hosts and networks. All hosts must be prepared to accept datagrams of up to 576 octets (whether they arrive whole or in fragments). It is recommended that hosts only send datagrams larger than 576 octets if they have assurance that the destination is prepared to accept the larger datagrams. The number 576 is selected to allow a reasonable sized data block to be transmitted in addition to the required header information. For example, this size allows a data block of 512 octets plus 64 header octets to fit in a datagram. The maximal internet header is 60 octets, and a typical internet header is 20 octets, allowing a margin for headers of higher level protocols.<br></p>

<p>
<b>Identification:</b> 16 bits<br>
An identifying value assigned by the sender to aid in assembling the fragments of a datagram.<br></p>

<p>
<b>Flags:</b> 3 bits<br>
Various Control Flags.<br>
Bit 0: reserved, must be zero<br>
Bit 1: (DF) 0 = May Fragment, 1 = Don’t Fragment.<br>
Bit 2: (MF) 0 = Last Fragment, 1 = More Fragments.<br></p>

<p>
<b>Fragment Offset:</b> 13 bits<br>
This field indicates where in the datagram this fragment belongs. The fragment offset is measured in units of 8 octets (64 bits). The first fragment has offset zero.<br></p>

<p>
<b>Time to Live:</b> 8 bits<br>
This field indicates the maximum time the datagram is allowed to remain in the internet system. If this field contains the value zero, then the datagram must be destroyed. This field is modified in internet header processing. The time is measured in units of seconds, but since every module that processes a datagram must decrease the TTL by at least one even if it process the datagram in less than a second, the TTL must be thought of only as an upper bound on the time a datagram may exist. The intention is to cause undeliverable datagrams to be discarded, and to bound the maximum datagram lifetime.<br></p>

<p>
<b>Protocol:</b> 8 bits<br>
This field indicates the next level protocol used in the data portion of the internet datagram. The values for various protocols are specified in "Assigned Numbers".<br></p>

<p>
<b>Header Checksum:</b> 16 bits<br>
A checksum on the header only. Since some header fields change (e.g., time to live), this is recomputed and verified at each point that the internet header is processed.<br></p>

<p>
<b>Source Address:</b> 32 bits<br><b>Destination Address:</b> 32 bits<br>
详见下文的地址说明<br></p>

<p>
<b>Options:</b> variable<br>
The options may appear or not in datagrams. They must be implemented by all IP modules (host and gateways). What is optional is their transmission in any particular datagram, not their implementation.<br></p>

<p>
<b>Padding:</b> variable<br>
The internet header padding is used to ensure that the internet header ends on a 32 bit boundary. The padding is zero.<br></p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">额外说明</h3>
<div class="outline-text-3" id="text-1-2">
<p>
<b>Addressing</b><br>
To provide for flexibility in assigning address to networks and allow for the large number of small to intermediate sized networks the interpretation of the address field is coded to specify a small number of networks with a large number of host, a moderate number of networks with a moderate number of hosts, and a large number of networks with a small number of hosts. In addition there is an escape code for extended addressing mode.<br></p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="right">
<col class="left">
<col class="left">
</colgroup>
<thead><tr>
<th scope="col" class="right">High Order Bit</th>
<th scope="col" class="left">Format</th>
<th scope="col" class="left">Class</th>
</tr></thead>
<tbody>
<tr>
<td class="right">0</td>
<td class="left">7 bits of net, 24 bits of host</td>
<td class="left">a</td>
</tr>
<tr>
<td class="right">10</td>
<td class="left">14 bits of net, 16 bits of host</td>
<td class="left">b</td>
</tr>
<tr>
<td class="right">110</td>
<td class="left">21 bits of net, 8 bits of host</td>
<td class="left">c</td>
</tr>
<tr>
<td class="right">111</td>
<td class="left">escape to extended addressing mode</td>
<td class="left">d</td>
</tr>
</tbody>
</table>
<p>
The local address, assigned by the local network, must allow for a single physical host to act as several distinct internet hosts. That is, there must be a mapping between internet host addresses and network/host interfaces that allows several internet addresses to correspond to one interface. It must also be allowed for a host to have several physical interfaces and to treat the datagrams from several of them as if they were all addressed to a single host.<br>
有关ip地址更详细的说明在 <a href="https://tools.ietf.org/html/rfc790">rfc790</a> 中，该文档中还包含ip地址和端口号的分配。<br></p>

<p>
私有网络地址（private network address）<br></p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left">
<col class="right">
<col class="right">
<col class="left">
</colgroup>
<thead><tr>
<th scope="col" class="left">Class</th>
<th scope="col" class="right">Private Networks</th>
<th scope="col" class="right">Subnet Mask</th>
<th scope="col" class="left">Address Range</th>
</tr></thead>
<tbody>
<tr>
<td class="left">a</td>
<td class="right">10.0.0.0</td>
<td class="right">255.0.0.0</td>
<td class="left">10.0.0.0 - 10.255.255.255</td>
</tr>
<tr>
<td class="left">b</td>
<td class="right">172.16.0.0 - 172.31.0.0</td>
<td class="right">255.240.0.0</td>
<td class="left">172.16.0.0 - 172.31.255.255</td>
</tr>
<tr>
<td class="left">c</td>
<td class="right">192.168.0.0</td>
<td class="right">255.255.0.0</td>
<td class="left">192.168.0.0 - 192.168.255.255</td>
</tr>
</tbody>
</table>
<p>
<b>Fragmentation and Reassembly</b><br>
The internet identification field (ID) is used together with the source and destination address, and the protocol fields, to identify datagram fragments for reassembly.<br>
The More Fragments flag bit (MF) is set if the datagram is not the last fragment. The Fragment Offset field identifies the fragment location, relative to the beginning of the original unfragmented datagram. Fragments are counted in units of 8 octets. The fragmentation strategy is designed so than an unfragmented datagram has all zero fragmentation information (MF = 0, fragment offset = 0). If an internet datagram is fragmented, its data portion must be broken on 8 octet boundaries.<br>
When fragmentation occurs, some options are copied, but others remain with the first fragment only.<br></p>

<p>
<b>Type of Service</b><br>
The type of service (TOS) is for internet service quality selection. The type of service is specified along the abstract parameters precedence, delay, throughput, and reliability. These abstract parameters are to be mapped into the actual service parameters of the particular networks the datagram traverses.<br>
Precedence. An independent measure of the importance of this datagram.<br>
Delay. Prompt delivery is important for datagrams with this indication.<br>
Throughput. High data rate is important for datagrams with this indication.<br>
Reliability. A higher level of effort to ensure delivery is important for datagrams with this indication.<br></p>

<p>
<b>Time to Live</b><br>
The time to live is set by the sender to the maximum time the datagram is allowed to be in the internet system. If the datagram is in the internet system longer than the time to live, then the datagram must be destroyed.<br>
This field must be decreased at each point that the internet header is processed to reflect the time spent processing the datagram. Even if no local information is available on the time actually spent, the field must be decremented by 1. The time is measured in units of seconds (i.e. the value 1 means one second). Thus, the maximum time to live is 255 seconds or 4.25 minutes. Since every module that processes a datagram must decrease the TTL by at least one even if it process the datagram in less than a second, the TTL must be thought of only as an upper bound on the time a datagram may exist. The intention is to cause undeliverable datagrams to be discarded, and to bound the maximum datagram lifetime.<br>
Some higher level reliable connection protocols are based on assumptions that old duplicate datagrams will not arrive after a certain time elapses. The TTL is a way for such protocols to have an assurance that their assumption is met.<br></p>

<p>
<b>Options</b><br>
The options are optional in each datagram, but required in implementations. That is, the presence or absence of an option is the choice of the sender, but each internet module must be able to parse every option. There can be several options present in the option field.<br>
The options might not end on a 32-bit boundary. The internet header must be filled out with octets of zeros. The first of these would be interpreted as the end-of-options option, and the remainder as internet header padding.<br>
Every internet module must be able to act on every option. The Security Option is required if classified, restricted, or compartmented traffic is to be passed.<br></p>

<p>
<b>Checksum</b><br>
The internet header checksum is recomputed if the internet header is changed. For example, a reduction of the time to live, additions or changes to internet options, or due to fragmentation. This checksum at the internet level is intended to protect the internet header fields from transmission errors.<br>
There are some applications where a few data bit errors are acceptable while retransmission delays are not. If the internet protocol enforced data correctness such applications could not be supported.<br></p>

<p>
<b>Errors</b><br>
Internet protocol errors may be reported via the ICMP messages.<br></p>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">参考资料</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>
<a href="https://en.wikipedia.org/wiki/Internet_Protocol">wikipedia - internet protocol</a><br>
</li>
<li>
<a href="https://tools.ietf.org/html/rfc791">ietf - rfc791 (Sep. 1981)</a><br>
</li>
<li>
<a href="https://tools.ietf.org/html/rfc790">ietf - rfc790 (Sep. 1981)</a><br>
</li>
</ul>
<p>
（全文完）<br></p>
</div>
</div>
  </div>
  

</article>
</div>

      <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12 sidebar">
       
<div class="sidebar-module sidebar-module-inset">
  
        <a href="https://github.com/samsonwang">
        <img alt style="padding-bottom:10px;max-width:60%" src="https://avatars3.githubusercontent.com/u/11832311?s=460&amp;v=4"></a>
        <div class="sidebar-aboutme">
        <h4>About Me</h4>
        <p>Zeal for coding, C++ developer. Focused on Linux server develop. I use EMACS on a daily basis.</p>
        </div>
</div>

       
<div class="sidebar-module sidebar-module-inset">
  <h4>Categories</h4>
  
        <ol class="list-unstyled sidebar-category">
<li>
<a href="/tags/category-cpp/">cpp</a>
        </li>
<li>
<a href="/tags/category-emacs/">emacs</a>
        </li>
<li>
<a href="/tags/category-linux/">linux</a>
        </li>
<li>
<a href="/tags/category-windows/">windows</a>
        </li>
</ol>
</div>

      </div>
<!--.sidebar-->
    </div>
<!--.row-->

    

    <ul class="pager hidden-print">
<li class="left">
          <a href="/posts/network-protocol-suite/" rel="prev">
            <p class="title">网络通信协议</p>
            <p>Previous post</p>
          </a>
      </li>
      <li class="right">
          <a href="/posts/algorithm-weekly-remove-nth-node-from-end-of-list/" rel="next">
            <p class="title">每周算法：删去单向链表倒数第n个节点</p>
            <p>Next post</p>
          </a>
      </li>
    </ul>
<section class="comments hidden-print"><h2>Comments</h2>
    
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="samsonwang-blog",
            disqus_url="https://blog.wangzhl.com/posts/internet-protocol/",
        disqus_title="IP\u534f\u8bae\uff08RFC791\uff09",
        disqus_identifier="cache/archives/2018/internet-protocol.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


  </section><script>var disqus_shortname="samsonwang-blog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer"><div class="text-center">
<p>Contents © 2017-2020 <a href="mailto:wangzhilv@gmail.com">Samson Wang</a>
 - Powered by <a href="https://getnikola.com/" rel="nofollow">Nikola</a>
 - Hosted on <a href="https://pages.github.com/" rel="nofollow">Github Pages</a>
 - 
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
<img alt="cc-by-nc 4.0" style="padding-bottom:2px" src="/images/cc-by-nc.png"></a>
</p>
</div>

      
    </footer>
</div>
</div>

<div id="scroll-top" title="back to top">
  <div id="scroll-top-arrow"></div>
  <div id="scroll-top-stick"></div>
</div>


            <script src="https://cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/jquery.colorbox/1.6.4/jquery.colorbox-min.js"></script><script src="https://cdn.staticfile.org/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script><script src="https://cdn.staticfile.org/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.1.1/js/bootstrap.min.js"></script><script src="/assets/js/moment-with-locales.min.js"></script><script src="/assets/js/fancydates.js"></script><script src="/assets/js/cerulean.js"></script><!-- fancy dates --><script>
  moment.locale("en");
  fancydates(0, "YYYY-MM-DD HH:mm");
</script><!-- end fancy dates --><!-- baidu tongji --><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1dcffb5494ab56e69005c957d7320ad1";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script><!-- Google Analytics - Global site tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108507797-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-108507797-1');
</script>
</body>
</html>
