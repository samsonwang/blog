<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>静态成员变量初始化相关问题 | Hack Note</title>
<meta name="theme-color" content="#04519b">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml">
<link href="/assets/css/minima.min.css" rel="stylesheet" type="text/css">
<link rel="canonical" href="https://blog.wangzhl.com/posts/static-member-initialization-and-private-member-function/">
<link rel="icon" href="/favicon.ico" sizes="64x64">
<link rel="prev" href="/posts/non-blocking-socket-connect-tips/" title="客户端使用非阻塞socket进行connect的流程" type="text/html">
<link rel="next" href="/posts/algorithm-weekly-integer-to-roman/" title="每周算法：阿拉伯数字转换罗马数字" type="text/html">
<meta name="author" content="Samson Wang">
<meta property="og:site_name" content="Hack Note">
<meta property="og:title" content="静态成员变量初始化相关问题">
<meta property="og:url" content="https://blog.wangzhl.com/posts/static-member-initialization-and-private-member-function/">
<meta property="og:description" content="引言


这篇文章的起因是出于对于 C++ 饿汉单例模式代码的一些疑问，查阅了一些资料。在仔细研究后，我发现在一些基础概念的理解还是存在偏差。
下面请看这样的一段代码，能看出其中有那些不太“正常”的语句么。


class Singleton
{
public:
    static Singleton* getInstance();
private:
    Singleton() {}
   ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-09-04T23:37:37+08:00">
<meta property="article:tag" content="cpp">
<meta property="article:tag" content="syntax">
</head>
<body>
  <header class="site-header nav-custom"><div class="wrapper">
      <a class="site-title" rel="author" href="/">Hack Note</a>
      <nav class="site-nav"><input type="checkbox" id="nav-trigger" class="nav-trigger"><label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px"><use href="/assets/svg/theme.svg#menu-icon"></use></svg></span>
        </label>
        <div class="trigger">
          
            <a class="page-link" href="/">Home</a>
            <a class="page-link" href="/archive/">Archive</a>
            <a class="page-link" href="/tags/">Tags</a>
            <a class="page-link" href="/about/">About</a>

        </div>
      </nav>
</div>
  </header><main class="page-content" aria-label="Content"><div class="wrapper">

    

    
<article class="post h-entry" itemscope="" itemtype="http://schema.org/BlogPosting"><header class="post-header"><h1 class="post-title p-name" itemprop="name headline">静态成员变量初始化相关问题</h1>

    <p class="post-meta">
      
    <time class="dt-published" datetime="2018-09-04T23:37:37+08:00" itemprop="datePublished">Sep 04, 2018</time></p>
  </header><div class="post-content e-content" itemprop="articleBody text">
    <div id="outline-container-org09e59bf" class="outline-2">
<h2 id="org09e59bf">引言</h2>
<div class="outline-text-2" id="text-org09e59bf">
<p>
这篇文章的起因是出于对于 <code>C++</code> 饿汉单例模式代码的一些疑问，查阅了一些资料。在仔细研究后，我发现在一些基础概念的理解还是存在偏差。<br>
下面请看这样的一段代码，能看出其中有那些不太“正常”的语句么。<br></p>

<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Singleton</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">Singleton</span><span class="o">*</span><span class="w"> </span><span class="n">getInstance</span><span class="p">();</span><span class="w"></span>
<span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">Singleton</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">Singleton</span><span class="o">*</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">Singleton</span><span class="o">*</span><span class="w"> </span><span class="n">Singleton</span><span class="o">::</span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Singleton</span><span class="p">();</span><span class="w"></span>
<span class="n">Singleton</span><span class="o">*</span><span class="w"> </span><span class="nf">Singleton::getInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>

<div id="outline-container-org4fa1860" class="outline-2">
<h2 id="org4fa1860">私有静态成员的初始化</h2>
<div class="outline-text-2" id="text-org4fa1860">
<p>
上面的代码是饿汉单例模式的 <code>C++</code> 的实现，在没有查阅资料之前，我对其中私有静态成员变量的初始化存疑。主要有以下两点：<br></p>
<ul class="org-ul">
<li>为什么私有变量能够在类外被修改<br>
</li>
<li>为什么私有构造函数能够在类外被调用<br>
</li>
</ul>
<p>
在我之前的知识积累中， <b>私有的成员变量或成员函数是不能够在类外被访问的</b> 。那么为什么以上代码没有问题呢？<br></p>

<p>
在C++标准中找到了下面的一段话(可以在 <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3690.pdf">C++11 standard</a> 的 9.4.2节 或  <a href="http://eel.is/c++draft/class.static.data#2">C++ standard working draft</a> 的 10.3.9.2节 中找到)<br></p>
<blockquote>
<p>
The initializer expression in the definition of a static data member is in the scope of its class.<br></p>
</blockquote>
<p>
这句话的意思是：静态成员变量的初始化是被看做为它自身的类域中的（ <del>翻译的可能不是很准</del> ）。这样就不难理解为什么私有的静态成员变量能够在其类外被初始化了，由其私有构造函数进行构造也能说的通了。<br></p>


<p>
<b>同样</b> ,在C++标准中给出了下面这样的示例代码：<br></p>
<div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">process</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">process</span><span class="o">*</span><span class="w"> </span><span class="n">run_chain</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">process</span><span class="o">*</span><span class="w"> </span><span class="n">running</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">process</span><span class="o">*</span><span class="w"> </span><span class="n">process</span><span class="o">::</span><span class="n">running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_main</span><span class="p">();</span><span class="w"></span>
<span class="n">process</span><span class="o">*</span><span class="w"> </span><span class="n">process</span><span class="o">::</span><span class="n">run_chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">running</span><span class="p">;</span><span class="w"></span>
</pre></div>

<p>
给出的说明如下：<br></p>
<blockquote>
<p>
The static data member <code>run_chain</code> of class process is defined in global scope; the notation <code>process​::​run_chain</code> specifies that the member <code>run_chain</code> is a member of class <code>process</code> and in the scope of class <code>process</code>. In the static data member definition, the initializer expression refers to the static data member running of class <code>process</code>.<br></p>
</blockquote>
<p>
静态成员 <code>run_chain</code> 定义在全局域；而 <code>process::run_chain</code> 则表示 <code>run_chain</code> 是 <code>process</code> 类的成员变量，从而处在 <code>process</code> 类的作用域中。<br></p>
</div>
</div>

<div id="outline-container-org72637d2" class="outline-2">
<h2 id="org72637d2">私有构造函数</h2>
<div class="outline-text-2" id="text-org72637d2">
<p>
在查阅资料时，我发现 Peter 的 <a href="https://stackoverflow.com/a/41361967">描述</a> 纠正了我对私有构造函数的一些看法。<br></p>
<blockquote>
<p>
The point of a <code>private</code> constructor is not preventing object construction. It is about controlling which code can access the constructor, and therefore limiting which code to create an object that is an instance of that class. A <code>private</code> constructor is accessible to all member functions ( <code>static</code> or otherwise) of the class, and to all declared <code>friend</code> s of the class (which may be individual functions, or other classes) - so any of those can create an instance of the class using a <code>private</code> constructor (assuming the constructor is defined).<br></p>
</blockquote>
<p>
私有构造函数的目的并不是禁止对象构造，其目的在于控制哪些代码能够调用这个构造函数，进而限制类对象的创建。私有的构造函数可以被该类的所有成员函数（静态或非静态的）调用，该类的友元类或友元方法也能访问该类的私有函数，所以在上述情况中都可以通过私有的构造函数实例化出类对象。<br></p>
</div>
</div>

<div id="outline-container-org4f93484" class="outline-2">
<h2 id="org4f93484">参考资料</h2>
<div class="outline-text-2" id="text-org4f93484">
<ul class="org-ul">
<li>
<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3690.pdf">ISO C++11 standard</a><br>
</li>
<li>
<a href="http://eel.is/c++draft/class.static.data#2">ISO C++ standard working draft</a><br>
</li>
<li>
<a href="https://stackoverflow.com/questions/38583989/access-to-private-static-function-during-static-member-initialization">stackoverflow.com - access to private static function…</a><br>
</li>
<li>
<a href="https://stackoverflow.com/questions/41361223/why-private-constructor-prevents-object-creation-c">stackoverflow.com - private constructor</a><br>
</li>
<li>
<a href="https://stackoverflow.com/questions/7857989/static-member-variable-when-declared-private">stackoverflow.com - static member variable when declared private</a><br>
</li>
<li>
<a href="https://en.cppreference.com/w/cpp/language/static#Static_data_members">cppreference.com - static data members</a><br>
</li>
</ul>
</div>
</div>
  </div>
  
  <ul class="tags-list vertical-center">
<li>
      <a class="badge" href="/tags/cpp/" rel="tag">cpp</a>
    </li>
    <li>
      <a class="badge" href="/tags/syntax/" rel="tag">syntax</a>
    </li>
  </ul></article><ul class="post-pager hidden-print">
<li class="previous">
      <a href="/posts/non-blocking-socket-connect-tips/" rel="prev">Previous post
        <br><span>客户端使用非阻塞socket进行connect的流程</span>
      </a>
    </li>
    <li class="next">
      <a href="/posts/algorithm-weekly-integer-to-roman/" rel="next">Next post
        <br><span>每周算法：阿拉伯数字转换罗马数字</span>
      </a>
    </li>
  </ul>
<section class="comments hidden-print"><div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="samsonwang-blog",
            disqus_url="https://blog.wangzhl.com/posts/static-member-initialization-and-private-member-function/",
        disqus_title="\u9759\u6001\u6210\u5458\u53d8\u91cf\u521d\u59cb\u5316\u76f8\u5173\u95ee\u9898",
        disqus_identifier="_cache/archives/2018/static-member-initialization-and-private-member-function.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


  </section><script>var disqus_shortname="samsonwang-blog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
  </main><footer class="site-footer h-card"><div class="wrapper">
      <div class="footer-col-wrapper">

        <div class="footer-col">
          <p class="site-desc">Personal handnote on software development</p>
        </div>

        <div class="footer-col">
          <div class="p-name">Samson Wang</div>
          <div class="copyright">Copyright 2023, all rights reserved.</div>
          <div class="social-links">
            <ul class="social-media-list">
<li><a rel="me" href="/rss.xml">
                <svg class="svg-icon grey"><use href="/assets/svg/social-icons.svg#rss"></use></svg></a></li>
              <li><a rel="nofollow" href="https://github.com/samsonwang">
                <svg class="svg-icon grey"><use href="/assets/svg/social-icons.svg#github"></use></svg></a></li>
              <li><a rel="nofollow" href="https://twitter.com/samsonwangcn">
                <svg class="svg-icon grey"><use href="/assets/svg/social-icons.svg#twitter"></use></svg></a></li>
              <li><a rel="nofollow" href="https://facebook.com/samsonwangcn">
                 <svg class="svg-icon grey"><use href="/assets/svg/social-icons.svg#facebook"></use></svg></a></li>
            </ul>
</div>

        </div>

      </div>

    </div>

  </footer><div id="scroll-top" title="back to top">
  <div id="scroll-top-arrow"></div>
  <div id="scroll-top-stick"></div>
</div>


      <script src="/assets/js/lazyload.min.js"></script><script src="/assets/js/minima.min.js"></script><!-- google adsense --><script data-ad-client="ca-pub-6303134192857919" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- Google Analytics - Global site tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108507797-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-108507797-1');
</script><!-- baidu tongji --><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1dcffb5494ab56e69005c957d7320ad1";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>
