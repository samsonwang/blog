<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="/assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Hack Note (Posts about lsof)</title><link>https://blog.wangzhl.com/</link><description></description><atom:link href="https://blog.wangzhl.com/tags/lsof.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2017-2023 &lt;a href="mailto:wangzhilv@gmail.com"&gt;Samson Wang&lt;/a&gt; 
&lt;a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"&gt;
&lt;img alt="cc-by-nc 4.0" style="padding-bottom:2px" src="/images/cc-by-nc.png" /&gt;&lt;/a&gt;
</copyright><lastBuildDate>Fri, 10 Mar 2023 03:30:34 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Linux常用命令行指令 - lsof</title><link>https://blog.wangzhl.com/posts/linux-command-examples-lsof/</link><dc:creator>Samson Wang</dc:creator><description>&lt;p&gt;
lsof是list open files的简称，用于列出系统中所有打开的文件。由于在linux系统下，所有 对象都是文件，所以这个指令十分有用。&lt;br&gt;
&lt;/p&gt;

&lt;p&gt;
下面就给出了几种常见的用法，需要注意的是有些指令需要root权限执行。&lt;br&gt;
&lt;/p&gt;

&lt;div id="outline-container-org6342684" class="outline-2"&gt;
&lt;h2 id="org6342684"&gt;1. 查看打开指定文件的进程&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org6342684"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof /var/syslog.log
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org5c45508" class="outline-2"&gt;
&lt;h2 id="org5c45508"&gt;2. 查看指定目录下打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org5c45508"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof +D /home/
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org294c4ae" class="outline-2"&gt;
&lt;h2 id="org294c4ae"&gt;3. 查看以指定进程名所有打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org294c4ae"&gt;
&lt;p&gt;
使用 &lt;code&gt;-c&lt;/code&gt; 命令能够查看指定进程名使用的文件，允许在一个命令行指令中使用多个 &lt;code&gt;-c&lt;/code&gt; 参数。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -c procname
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgcb611ee" class="outline-2"&gt;
&lt;h2 id="orgcb611ee"&gt;4. 查看使用指定挂载点的进程&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgcb611ee"&gt;
&lt;p&gt;
在停止挂载某个目录时，系统会告诉我们“设备资源繁忙”，所以我们需要找出使用挂载点的程序，终止这些进程，解除目录的占用状态。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof /home
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
或&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof +D /home/
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org6e35cb5" class="outline-2"&gt;
&lt;h2 id="org6e35cb5"&gt;5. 查看指定用户打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org6e35cb5"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -u username
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
另外还可以进行反向过滤，在输出中不显示指定用户的文件，语法如下。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -u ^username
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org3d55cc2" class="outline-2"&gt;
&lt;h2 id="org3d55cc2"&gt;6. 查看指定进程打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org3d55cc2"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -p pid
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org40466c4" class="outline-2"&gt;
&lt;h2 id="org40466c4"&gt;7. 终止属于某个用户的所有进程&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org40466c4"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;kill `lsof -t -u username`
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
相似的，可以使用 &lt;code&gt;-t&lt;/code&gt; 参数打印使用某个文件的进程id。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -t /var/log
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org79dea2d" class="outline-2"&gt;
&lt;h2 id="org79dea2d"&gt;8. 让结果同时满足多个选项&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org79dea2d"&gt;
&lt;p&gt;
默认情况下，多个参数是以或（or）进行操作的，可以使用 &lt;code&gt;-a&lt;/code&gt; 选项让结果同时满足多个参数。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -a -u username -c procname
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org03f6678" class="outline-2"&gt;
&lt;h2 id="org03f6678"&gt;9. 让命令重复执行&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org03f6678"&gt;
&lt;p&gt;
可以使用 &lt;code&gt;-r&lt;/code&gt; 参数让命令重复执行。以下命令会每隔5s执行一次，每次的执行结果会用 “====” 分割开。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -u username -c procname -a -r5
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org8643a65" class="outline-2"&gt;
&lt;h2 id="org8643a65"&gt;10. 列出所有的网络连接&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org8643a65"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
让结果中的ip地址和端口号显示数字而不是英文别名&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i -Pn
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
显示所有的 &lt;code&gt;AF_UNIX&lt;/code&gt; socket&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -U
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orga9df154" class="outline-2"&gt;
&lt;h2 id="orga9df154"&gt;11. 列出指定进程使用的网络连接&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orga9df154"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i -a -p pid
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org4a9361c" class="outline-2"&gt;
&lt;h2 id="org4a9361c"&gt;12. 查看指定端口上的监听&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org4a9361c"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i :portid
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgc3bd3c2" class="outline-2"&gt;
&lt;h2 id="orgc3bd3c2"&gt;13. 列出所有tcp和udp连接&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgc3bd3c2"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i tcp; lsof -i udp
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgad5e77e" class="outline-2"&gt;
&lt;h2 id="orgad5e77e"&gt;14. 列出所有的网络文件系统&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgad5e77e"&gt;
&lt;p&gt;
网络文件系统（network file system）&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -N -u username
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>linux</category><category>lsof</category><category>shell</category><guid>https://blog.wangzhl.com/posts/linux-command-examples-lsof/</guid><pubDate>Wed, 21 Mar 2018 12:28:34 GMT</pubDate></item></channel></rss>