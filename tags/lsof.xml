<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="/assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Hack Note (Posts about lsof)</title><link>https://samsonwang.me/</link><description></description><atom:link href="https://samsonwang.me/tags/lsof.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2017-2019 &lt;a href="mailto:wangzhilv@gmail.com"&gt;Samson Wang&lt;/a&gt; 
&lt;a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"&gt;&lt;img alt="知识共享许可协议" style="padding-bottom:2px" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /&gt;&lt;/a&gt;
</copyright><lastBuildDate>Wed, 15 May 2019 02:35:56 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Linux常用命令行指令 - lsof</title><link>https://samsonwang.me/posts/linux-command-examples-lsof/</link><dc:creator>Samson Wang</dc:creator><description>&lt;p&gt;
lsof是list open files的简称，用于列出系统中所有打开的文件。由于在linux系统下，所有 对象都是文件，所以这个指令十分有用。&lt;br&gt;
&lt;/p&gt;

&lt;p&gt;
下面就给出了几种常见的用法，需要注意的是有些指令需要root权限执行。&lt;br&gt;
&lt;/p&gt;

&lt;div id="outline-container-orga1d25b8" class="outline-2"&gt;
&lt;h2 id="orga1d25b8"&gt;1. 查看打开指定文件的进程&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orga1d25b8"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof /var/syslog.log
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgd816f73" class="outline-2"&gt;
&lt;h2 id="orgd816f73"&gt;2. 查看指定目录下打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgd816f73"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof +D /home/
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org7200044" class="outline-2"&gt;
&lt;h2 id="org7200044"&gt;3. 查看以指定进程名所有打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org7200044"&gt;
&lt;p&gt;
使用 &lt;code&gt;-c&lt;/code&gt; 命令能够查看指定进程名使用的文件，允许在一个命令行指令中使用多个 &lt;code&gt;-c&lt;/code&gt; 参数。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -c procname
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org3e17f2b" class="outline-2"&gt;
&lt;h2 id="org3e17f2b"&gt;4. 查看使用指定挂载点的进程&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org3e17f2b"&gt;
&lt;p&gt;
在停止挂载某个目录时，系统会告诉我们“设备资源繁忙”，所以我们需要找出使用挂载点的程序，终止这些进程，解除目录的占用状态。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof /home
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
或&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof +D /home/
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgc136a52" class="outline-2"&gt;
&lt;h2 id="orgc136a52"&gt;5. 查看指定用户打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgc136a52"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -u username
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
另外还可以进行反向过滤，在输出中不显示指定用户的文件，语法如下。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -u ^username
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org3c95588" class="outline-2"&gt;
&lt;h2 id="org3c95588"&gt;6. 查看指定进程打开的文件&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org3c95588"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -p pid
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgc64e1b7" class="outline-2"&gt;
&lt;h2 id="orgc64e1b7"&gt;7. 终止属于某个用户的所有进程&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgc64e1b7"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;kill `lsof -t -u username`
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
相似的，可以使用 &lt;code&gt;-t&lt;/code&gt; 参数打印使用某个文件的进程id。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -t /var/log
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org1f18149" class="outline-2"&gt;
&lt;h2 id="org1f18149"&gt;8. 让结果同时满足多个选项&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org1f18149"&gt;
&lt;p&gt;
默认情况下，多个参数是以或（or）进行操作的，可以使用 &lt;code&gt;-a&lt;/code&gt; 选项让结果同时满足多个参数。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -a -u username -c procname
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org1f4b801" class="outline-2"&gt;
&lt;h2 id="org1f4b801"&gt;9. 让命令重复执行&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org1f4b801"&gt;
&lt;p&gt;
可以使用 &lt;code&gt;-r&lt;/code&gt; 参数让命令重复执行。以下命令会每隔5s执行一次，每次的执行结果会用 “====” 分割开。&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -u username -c procname -a -r5
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org80a8581" class="outline-2"&gt;
&lt;h2 id="org80a8581"&gt;10. 列出所有的网络连接&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org80a8581"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
让结果中的ip地址和端口号显示数字而不是英文别名&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i -Pn
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
显示所有的 &lt;code&gt;AF_UNIX&lt;/code&gt; socket&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -U
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgb800d18" class="outline-2"&gt;
&lt;h2 id="orgb800d18"&gt;11. 列出指定进程使用的网络连接&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgb800d18"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i -a -p pid
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org4a011ab" class="outline-2"&gt;
&lt;h2 id="org4a011ab"&gt;12. 查看指定端口上的监听&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org4a011ab"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i :portid
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org48bc62d" class="outline-2"&gt;
&lt;h2 id="org48bc62d"&gt;13. 列出所有tcp和udp连接&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org48bc62d"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -i tcp; lsof -i udp
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org99fe0bd" class="outline-2"&gt;
&lt;h2 id="org99fe0bd"&gt;14. 列出所有的网络文件系统&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org99fe0bd"&gt;
&lt;p&gt;
网络文件系统（network file system）&lt;br&gt;
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lsof -N -u username
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>linux</category><category>lsof</category><category>shell</category><guid>https://samsonwang.me/posts/linux-command-examples-lsof/</guid><pubDate>Wed, 21 Mar 2018 12:28:34 GMT</pubDate></item></channel></rss>